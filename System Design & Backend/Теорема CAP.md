**CAP-теорема** (также известная как теорема Брюера) — это фундаментальный принцип в проектировании распределенных систем. Она утверждает, что в любой распределенной системе (где данные хранятся на нескольких узлах/серверах) можно обеспечить **не более двух** из трех свойств одновременно.

### Три термина (компонента) теоремы

Теорема оперирует тремя ключевыми характеристиками, из первых букв которых и складывается название:
1. **C (Consistency) — Согласованность:** На всех узлах системы в один и тот же момент времени данные одинаковы. Если вы записали данные на один сервер, любая последующая попытка чтения с любого другого сервера должна вернуть это новое значение.
2. **A (Availability) — Доступность:** Любой запрос к работающему узлу системы завершается корректным ответом (система всегда «отвечает»), хотя ответ не гарантирует получение самой последней версии данных.
3. **P (Partition Tolerance) — Устойчивость к разделению:** Система продолжает работать, даже если связь между узлами пропала (произошло «разделение» сети).

### Почему нельзя выбрать всё сразу?

В мире распределенных систем сетевые сбои неизбежны. Поэтому **P (устойчивость к разделению)** считается обязательным свойством. Когда сеть «разрывается», перед разработчиком встает выбор между **C** и **A**:
- **Выбираем CP (Согласованность + Устойчивость):** Если узлы не могут связаться друг с другом, система блокирует запросы (теряет доступность), чтобы не выдать устаревшие данные или не допустить противоречий.
- **Выбираем AP (Доступность + Устойчивость):** Система продолжает отвечать на запросы, даже если данные на разных узлах рассинхронизированы. В этом случае пользователь может увидеть старую информацию, но сервис останется рабочим.
- **CA (Согласованность + Доступность):** Возможна только в идеальных условиях, где сеть никогда не ломается. Для распределенных систем этот вариант практически недостижим.

### Примеры из реальной жизни

#### 1. Банкомат (Пример CP-системы)

Представьте, что вы снимаете деньги. Банкомат (узел А) потерял связь с центральным сервером банка (узел Б).
- **Если бы банк выбрал AP:** Банкомат выдал бы вам деньги, не зная вашего точного баланса. Вы могли бы снять больше, чем у вас есть (уязвимость для банка).
- **Реальный выбор (CP):** Банкомат выдаст ошибку «Связь с банком прервана». Система пожертвовала **доступностью** (вы не получили услугу), чтобы сохранить **согласованность** (баланс остался верным).
    

#### 2. Лента в соцсетях (Пример AP-системы)

Вы заходите в профиль друга в Instagram или Facebook.
- Ваш друг только что обновил фото, но из-за сбоя в сети между серверами вы видите старое фото.
- Для соцсети не критично, если вы увидите пост на пару минут позже. Главное, чтобы приложение открылось и работало. Здесь выбирают **доступность**, жертвуя мгновенной **согласованностью**.
    

#### 3. Онлайн-магазин (Комбинированный подход)
- **Оформление заказа:** Часто CP. Важно, чтобы товар не купили два человека одновременно, если осталась последняя единица. Система скорее «повиснет» или выдаст ошибку, чем продаст несуществующий товар.
- **Корзина товаров:** Обычно AP (как в Amazon). Вы можете добавлять товары в корзину, даже если какой-то узел базы данных недоступен. Синхронизация произойдет позже.
    



### В каких случаях применяется?

- **CP** используется там, где данные критически важны: финансы, медицинские записи, системы инвентаризации.
- **AP** используется там, где важна скорость и отзывчивость: ленты новостей, комментарии, аналитика больших данных, рекомендательные системы.