

В контексте распределенных систем и баз данных уровни изоляции — это компромисс между **производительностью** (скоростью работы) и **консистентностью** (точностью данных). Они определяют, насколько изменения, сделанные одной транзакцией, видимы для других параллельных транзакций.

## Основные проблемы (феномены), которые мы решаем

Прежде чем разбирать уровни, важно понять «болезни», от которых они лечат:
- **Грязное чтение (Dirty Read):** Транзакция А читает данные, которые транзакция Б изменила, но еще не зафиксировала (не сделала `COMMIT`). Если Б откатится, данные у А станут мусором.
- **Неповторяющееся чтение (Non-repeatable Read):** Транзакция А читает строку дважды, но между чтениями транзакция Б меняет эту строку. В итоге А получает два разных значения.
- **Фантомное чтение (Phantom Read):** Транзакция А читает набор строк по условию (например, «все заказы клиента»). В это время Б добавляет новую строку. При повторном поиске у А внезапно появляется «фантомная» запись.

## Уровни изоляции (по стандарту SQL)

### 1. Read Uncommitted (Чтение незафиксированных данных)

Самый низкий уровень. Разрешает «грязное чтение».
- **Проблема:** Полное отсутствие защиты.
- **Пример:** Счетчик просмотров статьи в блоге или лайков. Если данные чуть-чуть разойдутся на долю секунды — никто не умрет. Зато это очень быстро.
    
### 2. Read Committed (Чтение зафиксированных данных)

Золотой стандарт, используется по умолчанию во многих БД (PostgreSQL, Oracle). Транзакция видит только те данные, которые были зафиксированы до её начала.
- **Решает:** Грязное чтение.
- **Оставляет:** Неповторяющееся чтение.
- **Пример:** Выгрузка отчета по продажам. Пока вы листаете страницы отчета, кто-то может изменить цену товара на первой странице, и если вы вернетесь назад — цена будет уже другой.
    
### 3. Repeatable Read (Повторяющееся чтение)

Гарантирует, что если вы прочитали строку, она не изменится до конца транзакции.
- **Решает:** Неповторяющееся чтение.
- **Оставляет:** Фантомное чтение (в классическом SQL).
- **Пример:** Редактирование профиля пользователя. Вы открыли данные, начали их менять, и база гарантирует, что пока вы не закончите, никто другой не подменит эти же поля «под капотом».
    

### 4. Serializable (Сериализуемость)

Самый строгий уровень. Транзакции выполняются так, будто они идут строго друг за другом, даже если на самом деле они параллельны.
- **Решает:** Все вышеперечисленные проблемы.
- **Цена:** Огромное падение производительности из-за блокировок или частых откатов транзакций.4
- **Пример:** Перевод денег между счетами. Если А переводит Б 100$, а в это время начисляется процент на остаток, система должна гарантировать, что баланс сойдется до цента, без каких-либо аномалий.

## Уровни в распределенных системах (Snapshot Isolation)

В современных распределенных системах часто говорят про **Snapshot Isolation (SI)**. Суть в том, что каждая транзакция работает со своим «снимком» (snapshot) базы данных на момент начала.
- **Преимущество:** Писатели не блокируют читателей.
- **Проблема (Write Skew):** Аномалия записи. Например, в больнице должен дежурить хотя бы один врач. Два врача одновременно пытаются уйти с дежурства. Оба видят в своем «снимке», что их двое, и оба уходят. В итоге в больнице 0 врачей.

## Сводная таблица

|**Уровень**|**Грязное чтение**|**Неповторяющееся чтение**|**Фантомы**|
|---|---|---|---|
|**Read Uncommitted**|Да|Да|Да|
|**Read Committed**|Нет|Да|Да|
|**Repeatable Read**|Нет|Нет|Да|
|**Serializable**|Нет|Нет|Нет|
