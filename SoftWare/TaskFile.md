**Task** — это инструмент автоматизации задач (task runner), написанный на языке Go. Он предназначен для упрощения и стандартизации процессов разработки: запуск тестов, сборка проекта, линтинг, миграции баз данных и многое другое.

Основной файл конфигурации называется `Taskfile.yml` (или `Taskfile.yaml`)

Офф сайт: [https://taskfile.dev](https://taskfile.dev)

## Установка
- С использованием стандартного менеджера пакетов в Power Shell (Win)
```power shell
winget install Task.Task
```

- go install
```bash
go install github.com/go-task/task/v3/cmd/task@latest
```

- возможны иные пути установки (см. офф. доки)


## Преимущества Taskfile перед Makefile
`Task` предлагает ряд современных преимуществ, особенно для веб-разработки и кроссплатформенных проектов.

| Характеристика           | Makefile                                                     | Taskfile                                                                   |
| ------------------------ | ------------------------------------------------------------ | -------------------------------------------------------------------------- |
| **Синтаксис**            | Специфический, чувствителен к табуляциям (Tabs).             | Стандартный **YAML**. Легче читать и писать.                               |
| **Кроссплатформенность** | Заточен под Unix-shell. На Windows требует Git Bash или WSL. | **Нативная поддержка Windows, macOS, Linux.** Команды адаптируются под ОС. |
| **Переменные**           | Специфический синтаксис (`$(VAR)`), сложная логика.          | Поддержка **Go templates**, переменные окружения, `.env` файлы.            |
| **Вложенность**          | Сложно включать другие Makefile.                             | Поддержка **includes** (модульность конфигурации).                         |
| **Статус задач**         | Сложно реализовать проверку "изменился ли файл".             | Встроенная директива `status` для проверки актуальности задачи.            |
| **Параллелизм**          | Требует флагов и осторожности.                               | Встроенная поддержка параллельного выполнения задач.                       |

## Возможности Taskfile

1. **Зависимости задач:** Одна задача может вызывать другие до своего выполнения.
2. **Переменные и шаблоны:** Динамическая генерация команд.
3. **Переменные окружения:** Легкое управление `ENV`.
4. **Поддержка .env:** Автоматическая загрузка файлов `.env`.
5. **Модульность:** Разбиение большого файла на несколько через `includes`.
6. **Платформенная специфика:** Разные команды для Windows, Linux и macOS в одной задаче.
7. **Проверка статуса (Status):** Задача выполняется только если файлы изменились (аналог `make` targets, но гибче).
8. **Игнорирование ошибок:** Возможность продолжить выполнение, если команда вернула ошибку.


## Параметры CLI
#### Информация и навигация

| Параметр     | Краткий | Описание                                                      |
| ------------ | ------- | ------------------------------------------------------------- |
| `--help`     | `-h`    | Показать справку по всем командам.                            |
| `--version`  |         | Показать текущую версию Task.                                 |
| `--list`     | `-l`    | Показать список задач с описанием (`desc`).                   |
| `--list-all` | `-a`    | Показать **все** задачи (включая те, у которых нет описания). |
| `--init`     | `-i`    | Создать новый файл `Taskfile.yml` в текущей директории.       |
| `--summary`  |         | Получить справку по конкретной задаче                         |
```bash
task --list          # Показать основные задачи
task --list-all      # Показать даже скрытые/внутренние задачи
task build --summary 
```
## Управление выполнением

| Параметр     | Краткий | Описание                                                                                                                 |
| ------------ | ------- | ------------------------------------------------------------------------------------------------------------------------ |
| `--force`    | `-f`    | **Принудительный запуск.** Игнорирует проверки `status` и `sources`. Задача выполнится всегда.                           |
| `--dry`      | `-n`    | **Пробный запуск.** Покажет команды, которые будут выполнены, но не запустит их. Полезно для проверки логики.            |
| `--status`   | `-s`    | **Проверка статуса.** Не выполняет задачи, а только проверяет, актуальны ли они (exit code 0 — актуально, 1 — устарело). |
| `--parallel` | `-p`    | **Параллелизм.** Запускает задачи внутри `cmds` параллельно (по умолчанию они последовательны).                          |
| `--watch`    | `-w`    | **Режим наблюдения.** Запускает задачу и перезапускает её при изменении файлов (указанных в `sources`).                  |
```bash
task build --force       # Собрать проект, даже если файлы не менялись
task build --dry         # Узнать, что произойдет при сборке, без реального запуска
task  build --status     # Проверить, нужно ли собирать проект (для CI/CD)
task  dev  --watch       # Запуск сервера разработки с авто-рестартом
```



#### Пути и конфигурация
|Параметр|Краткий|Описание|
|---|---|---|
|`--dir`|`-d`|Указать рабочую директорию для поиска Taskfile и выполнения команд.|
|`--taskfile`|`-t`|Указать конкретный файл Taskfile (по умолчанию ищет `Taskfile.yml`).|
|`--env`||Указать путь к файлу `.env` (по умолчанию ищет `.env` в корне).|
```bash
task -d ./backend build      # Запустить задачу build из папки backend
task -t CustomTaskfile.yml   # Использовать альтернативный файл конфигурации
```


#### Вывод и логирование
| Параметр        | Краткий | Описание                                                                                                                                        |
| --------------- | ------- | ----------------------------------------------------------------------------------------------------------------------------------------------- |
| `--verbose`     | `-v`    | **Подробный вывод.** Показывает каждую выполняемую команду и её вывод.                                                                          |
| `--silent`      |         | **Тихий режим.** Скрывает вывод самих команд, показывает только результат (stdout/stderr).                                                      |
| `--output`      | `-o`    | **Режим вывода.** Управляет тем, как отображается вывод параллельных задач.  <br>Варианты: `interleaved` (по умолчанию), `grouped`, `prefixed`. |
| `--concurrency` | `-C`    | Ограничить количество одновременно выполняемых задач (число).                                                                                   |
```bash
task -v build            # Показать подробный лог сборки
task --silent deploy     # Скрыть команды деплоя, показать только ошибки
task --parallel --output grouped all # Группировать вывод параллельных задач
```

## Базовый синтаксис и структура файла Taskfile.yml

Файл `Taskfile.yml` состоит из нескольких ключевых секций.

## Переменные в Taskfile.yml

#### `vars:` (Переменные задач Task)
- **Назначение:** Внутренние переменные движка Task.
- **Как используются:** Доступны только внутри синтаксиса шаблонов Task: `{{.ИМЯ_ПЕРЕМЕННОЙ}}`.
- **Видимость для команд:** **Не экспортируются** в операционную систему автоматически. Если вы запустите скрипт (Python, Go, Node.js), он **не увидит** переменную из `vars:` через стандартные методы чтения переменных окружения (например, `os.getenv()` в Python).
- **Гибкость:** Поддерживают сложные шаблоны Go (конкатенация, функции даты, условия).

#### `env:` (Переменные окружения)
- **Имеют преимущество перед vars: в случае конфликта имен**
- **Назначение:** Реальные переменные окружения операционной системы (Environment Variables).
- **Как используются:** Доступны в шаблонах Task `{{.ИМЯ}}` **И** в shell-командах как `$ИМЯ` (Linux/Mac) или `%ИМЯ%` (Windows).
- **Видимость для команд:** **Экспортируются** в процесс. Любой скрипт или программа, запущенная в `cmds`, увидит эту переменную.
- **Использование:** Критически важны для конфигурации приложений (например, `DATABASE_URL`, `API_KEY`, `NODE_ENV`).

#### Разница между Глобальными и Локальными переменными

Здесь разница заключается в **области видимости (Scope)** внутри файла `Taskfile.yml`.
##### Глобальные переменные
- **Где объявляются:** В корне файла `Taskfile.yml` (на одном уровне с `tasks:`).
- **Область видимости:** Доступны **во всех задачах** файла.
- **Зачем нужны:** Для конфигурации всего проекта (имя проекта, версия, общие пути).

##### Локальные переменные
- **Где объявляются:** Внутри конкретной задачи в блоке `vars:`.
- **Область видимости:** Доступны **только внутри этой задачи** (в её `cmds`, `deps`, `status`).
- **Зачем нужны:** Для временных вычислений, специфичных для одной задачи.
- **Приоритет:** Локальная переменная **перекрывает (shadowing)** глобальную, если у них одинаковое имя.

### Общая форма файла с объяснениями
```yml
# Версия схемы Taskfile. Рекомендуется всегда указывать '3'.
version: '3'

# Глобальные переменные, доступные во всех задачах
vars:
  GLOBAL_VAR: "значение"

# Глобальные переменные окружения
env:
  ENV_MODE: "development"

# Подключение других Taskfile (модульность)
includes:
  backend: ./backend/Taskfile.yml
  frontend: ./frontend/Taskfile.yml

# Секция с задачами
tasks:
  # Имя задачи (вызывается как 'task <имя>')
  имя-задачи:
    desc: "Описание задачи (видно в task --list)"
    deps: [] # Зависимости (задачи, которые выполнятся до этой)
    cmds: [] # Команды для выполнения
    vars: {} # Локальные переменные
    env: {}  # Локальные переменные окружения
    status: [] # Команды для проверки, нужно ли запускать задачу
    sources: [] # Файлы, при изменении которых задача считается устаревшей
    generates: [] # Файлы, которые создает эта задача
    method: "checksum" # Метод проверки (timestamp или checksum)
    silent: false # Скрывать вывод команд
    ignore_error: false # Не прерывать выполнение при ошибке
    platforms: # Ограничение по ОС
      - linux
      - darwin
```


## Примеры использования с комментариями

Создайте файл `Taskfile.yml` в корне проекта и разберите следующие примеры.

### Пример 1: Простая задача (Hello World)
```yml
version: '3'

tasks:
  # Задача 'hello' выводит приветствие
  hello:
    desc: "Выводит приветственное сообщение"
    cmds:
      - echo "Привет, Task!"
      - echo "Запуск на ОС: {{.OS}}" # Использование встроенной переменной
```
_Запуск:_ `task hello`

### Пример 2: Зависимости и переменные
```yml
version: '3'

vars:
  APP_NAME: "MyProject"
  VERSION: "1.0.0"

tasks:
  # Эта задача выполнится первой
  prepare:
    cmds:
      - echo "Подготовка окружения..."
      - mkdir -p dist

  # Эта задача зависит от 'prepare'
  build:
    desc: "Сборка проекта"
    deps: [prepare] # Зависимость
    vars:
      BUILD_TIME: "{{now | date \"2006-01-02\"}}" # Динамическая переменная
    cmds:
      - echo "Сборка {{.APP_NAME}} версии {{.VERSION}}"
      - echo "Время сборки: {{.BUILD_TIME}}"
      # Имитация сборки
      - touch dist/app.bin
```
_Запуск:_ `task build` (автоматически запустит `prepare` перед этим).

### Пример 3: Работа с .env и командами для разных ОС
Task автоматически загружает `.env`, если он есть в корне.
```yml
version: '3'

tasks:
  server:
    desc: "Запуск локального сервера"
    env:
      PORT: 8080 # Можно переопределить переменную из .env
    cmds:
      # Task пытается угадать shell, но можно указать команды для конкретных ОС
      - task: echo-os
      
  echo-os:
    cmds:
      # Команды внутри platforms выполняются только на указанной ОС
      - platform: linux
        cmd: echo "Запуск на Linux"
      - platform: windows
        cmd: echo "Запуск на Windows"
      - platform: darwin
        cmd: echo "Запуск на macOS"
```
_Запуск:_ `task compile`. При повторном запуске без изменений в `src`, задача будет пропущена.


### Пример 5: Параллельное выполнение
```yml
version: '3'

tasks:
  all:
    desc: "Запуск тестов и линтера параллельно"
    deps:
      - test
      - lint
    # По умолчанию зависимости выполняются последовательно.
    # Для параллельности нужно вызвать их в cmds с флагом --parallel или использовать структуру ниже:
    
  parallel-job:
    cmds:
      - task: test
      - task: lint
    # В Task v3 зависимости (deps) всегда последовательны. 
    # Для реального параллелизма внутри cmds используется флаг запуска task --parallel,
    # но внутри Taskfile можно полагаться на асинхронность внешних процессов.
    
  test:
    cmds:
      - echo "Тесты запущены..."
      - sleep 2
      
  lint:
    cmds:
      - echo "Линтер запущен..."
      - sleep 2
```
_Запуск:_ `task --parallel all` (флаг `--parallel` заставляет задачи внутри `cmds` выполняться параллельно).

