### Структура Dockerfile
- Базовый образ 
```Dockerfile
FROM ubuntu:22.04
```
- Описание образа . Туда пишется любая информация о нашем будущем образе
```Dockerfile
LABEL author=Xyersh lang=english
```
- Команды. выполняются на базовом образе. Выполняется во время сборки образа.
```Dockerfile
RUN apt-get update
RUN apt-get  install nginx -y
```
- Рабочие директории будущего образа
```Dockerfile
WORKDIR /var/www/html
```
- Копирование файлов с хоста в образ
```Dockerfile
COPY files/index.html .
COPY files/script.js /opt/script.js
```
- Работа с файлами (например раздать права на файл)
```Dockerfile
RUN chmod +x /opt/script.js
```
- Указание переменных
```Dockerfile
ENV OWNER="Xyersh"
ENV TYPE=demo
```
- Указать используемые в приложении порты
```Dockerfile
EXPOSE 80
```
- Описать команды при запуске контейнера
```Dockerfile
ENTRYPOINT ["echo"]
CMD ["Hello my first Docker"]
```
### Сборка образа
Для сборки образа необходим файл  Dockerfile с инструкциями. 
Также используется команда `docker build`
 `docker build  <локальный путь к Dockerfile> [параметры]` - собрать образ на основе Dockerfile: `docker build --platform limux/amd64 -t ubuntu:20.4 .`
- `-f` - явно указать имя файла, с которого будет проходить сборка (если нужно что-то вместо Dockerfile)
- `-t` - указать имя нового образа
- `--platform <planform_name>` - указать платформу, для которой будет билдится образ. Например `linux/amd64` 



### Команды Dockerfile
Комментарии начинаются с символа`#`
`# это текст коментария, его содержимое игнорируется докерам`

Команды:
- `ADD <src> <dest>` -  может распаковывать архивы,  где `src` - может являться фалом, URL, или архивом, `dest` - путь к файлу назначения в образе.
- `ARG` - переменные передаваемые при сборке образа
- `CMD ["команда"]` - команды которые выполняются во время запуска контейнера. Например, запуск сервера. Если при запуске контейнера указать команду, то она заменит `CMD` из Dockerfile
- `COPY <file_from> <file_to>` - копирование файлов `file_from` из директории хостовой среды в образ, как `<file_to>`


- `ENTRYPOINT ["команда"]` - команды для запуска приложения. Если при запуске контейнера указать команду, то она дополнит команду из `ENTRYPOINT` в качестве параметра `ENTRYPOINT`
- `ENV` - задает переменные окружения
- `EXPOSE` - указывает порт для работы контейнера. Имеет чисто декларативный характер. Наличие `EXPOSE` в файле **Dockerfile** не освобождает от необходимости ручного пробрасывания портов при выполнении команды `docker run`. 
  `EXPOSE` используется для того чтобы пользователь мог подсмотреть, на каком порту работает приложение.
- `FROM <образ:тег>` - указывает из какого базового образа формируется новый
- `RUN <команды>`  - запуск команд оболочки в образе (установка пакетов). Выполняется во время сборки образа. Используется для установки зависимостей, создания директорий, настройки окружения, компиляции кода. Пример: 
```Dockerfile
		 RUN apt-get update && apt-get install -y git vim curl
```
- `USER` - задает пользователя для выполнения команд
- `VALUME` - задает точку монтирования для данных
- `WORKDIR <рабочая директория>` - установить рабочий каталог приложения в образе



### Совместное использование ENTRYPOINT и CMD
|                                |                            |                                    |                                                |
| ------------------------------ | -------------------------- | ---------------------------------- | ---------------------------------------------- |
|                                | **No ENTRYPOINT**          | **ENTRYPOINT exec_entry p1_entry** | **ENTRYPOINT [“exec_entry”, “p1_entry”]**      |
| **No CMD**                     | error, not allowed         | /bin/sh -c exec_entry p1_entry     | exec_entry p1_entry                            |
| **CMD [“exec_cmd”, “p1_cmd”]** | exec_cmd p1_cmd            | /bin/sh -c exec_entry p1_entry     | exec_entry p1_entry exec_cmd p1_cmd            |
| **CMD [“p1_cmd”, “p2_cmd”]**   | p1_cmd p2_cmd              | /bin/sh -c exec_entry p1_entry     | exec_entry p1_entry p1_cmd p2_cmd              |
| **CMD exec_cmd p1_cmd**        | /bin/sh -c exec_cmd p1_cmd | /bin/sh -c exec_entry p1_entry     | exec_entry p1_entry /bin/sh -c exec_cmd p1_cmd |

### Разница в использовании ADD и COPY

`COPY` - наиболее часто применяемая коменда по сравнению с `ADD`. Предназначен исключительно для копировани файлов с хостовой системы в образ.

`ADD` - помимо фалов может автоматически разворачивать tar-архивы из хост-системы в бораз. А также копировать фалы по URL. Если по URL копируется архив, то затем его следует востаровить командой `RUN`