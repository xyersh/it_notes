
### Что Такое HTTP?

**HTTP (Hypertext Transfer Protocol)** — это протокол прикладного уровня, используемый для передачи гипермедиа-документов, таких как HTML. Он является основой любой коммуникации данных в Интернете. HTTP разработан для распределенных, совместных, гипермедийных информационных систем.

#### Ключевые характеристики:

- **Клиент-серверная архитектура:** HTTP работает по принципу "запрос-ответ". Клиент (например, веб-браузер) отправляет запрос, а сервер (веб-сервер) на него отвечает.
- **Состояние отсутствует (Stateless):** Каждая пара запрос-ответ обрабатывается независимо. Сервер не хранит информацию о предыдущих запросах клиента. Это делает HTTP масштабируемым и простым, но требует использования дополнительных механизмов (например, cookies, SessionID, JWT и т.д.) для сохранения состояния сессии.
- **Медиа-независимость (Media Independent):** HTTP может передавать данные любого типа, если и клиент, и сервер знают, как их обработать (MIME-типы).
- **Использование TCP:** HTTP строится поверх протокола TCP (Transmission Control Protocol), который обеспечивает надежную, упорядоченную и безошибочную доставку данных.


### Как Работает HTTP?

Работа HTTP начинается, когда пользователь вводит URL в браузере или кликает по ссылке.

**Основные шаги:**

1. **Разрешение DNS:** Браузер определяет IP-адрес доменного имени (например, `google.com`) с помощью системы доменных имен (DNS).
2. **Установка TCP-соединения:** Браузер устанавливает TCP-соединение с веб-сервером по порту 80 (для HTTP) или 443 (для HTTPS).
3. **Отправка HTTP-запроса:** Браузер формирует и отправляет HTTP-запрос к серверу.
4. **Обработка запроса сервером:** Сервер принимает запрос, обрабатывает его (например, находит запрошенный файл) и формирует HTTP-ответ.
5. **Отправка HTTP-ответа:** Сервер отправляет HTTP-ответ обратно браузеру.
6. **Получение и отображение данных:** Браузер получает ответ, разбирает его, и если это HTML-страница, начинает ее отрисовку. В процессе отрисовки могут быть запрошены дополнительные ресурсы (изображения, CSS, JavaScript), что приводит к новым HTTP-запросам.
7. **Закрытие TCP-соединения:** После завершения обмена данными TCP-соединение может быть закрыто.


### Описание запроса/ответа http
- [[HTTP-запрос (разбор)|Описание запроса]]
- [[HTTP-ответ (разбор)|Описание ответа]]

### Методы HTTP
[[Методы http-запросов]]


### Передача параметров в http-запросах
Параметры могут передаваться в HTTP-запросе следующими основными способами:
- **В самом URI запроса(path param)**: Являются частью самой структуры URI и помогают идентифицировать ресурс, что часто используется в **RESTful API** для создания "человекопонятных" URL. Например`GET /api/users/123` . `123` - это параметр пути. Он идентифицирует конкретного пользователя с ID `123`.

- **В строке запроса (query param)**: Это самый распространённый способ. Параметры добавляются к URL после знака **`?`** в виде пар **`ключ=значение`**, разделённых знаком **`&`**.  Например,  **`https://example.com/search?q=параметры&page=1`**. Этот метод используется для передачи небольших объёмов данных, например, для фильтрации, поиска или пагинации. Он подходит для **GET**-запросов.
    
- **В теле запроса (Request Body)**: Этот способ используется для передачи больших объёмов данных, например, при отправке форм или загрузке файлов. Данные передаются в теле HTTP-запроса в различных форматах, таких как **JSON**, **XML**, **multipart/form-data** или **x-www-form-urlencodeв**. Этот метод в основном используется для **POST**, **PUT** и **PATCH**-запросов.
    
- **В заголовках запроса (Request Headers)**: Параметры могут быть переданы в заголовках, чтобы предоставить метаданные о запросе. Например, заголовок **`Authorization`** содержит токен для аутентификации, а **`Content-Type`** — тип данных в теле запроса. Этот метод обычно не используется для передачи данных, которые являются частью логики приложения, но важен для предоставления информации о самом запросе.


### Коды HTTP-ответов
[[Коды ответов на http-запросы]]
### Отправка и получение бинарных данных по HTTP

HTTP по своей сути текстовый протокол, но он прекрасно справляется с передачей бинарных данных. Это достигается за счет нескольких механизмов:

1. **Заголовок `Content-Type`:** Этот заголовок в HTTP-ответе является ключевым. Он указывает клиенту (браузеру), какой тип данных содержится в теле ответа. Например:
    
    - `image/jpeg` для изображений JPEG
    - `image/png` для изображений PNG
    - `application/pdf` для PDF-файлов
    - `audio/mpeg` для MP3-аудио
    - `video/mp4` для MP4-видео
    - `application/octet-stream` для произвольных бинарных данных, когда тип не определен или клиент должен предложить сохранение файла.
        
    
    Когда браузер получает ответ с `Content-Type: image/jpeg`, он знает, что тело сообщения содержит JPEG-изображение, и обрабатывает его соответствующим образом (например, отображает его на веб-странице).
    
2. **Прямая передача байтов:** Несмотря на то, что HTTP-сообщения выглядят как текст, тело сообщения может содержать сырые байты, которые представляют бинарные данные. TCP, на котором построен HTTP, не различает "текст" и "бинарные данные" — для него это просто поток байтов. HTTP предоставляет метаинформацию (заголовки), чтобы клиент мог интерпретировать этот поток.
    
3. **Заголовок `Content-Length`:** Указывает размер тела сообщения в байтах. Это позволяет клиенту узнать, сколько данных ему нужно ожидать, чтобы полностью получить бинарный файл.
    
4. **Кодирование (Encoding) - опционально:** Иногда бинарные данные могут быть закодированы в текстовый формат (например, Base64) для передачи через системы, которые могут некорректно обрабатывать сырые бинарные данные. Однако, для большинства случаев передачи файлов по HTTP, это не требуется, так как HTTP сам по себе способен корректно передавать бинарные данные. `Content-Transfer-Encoding` использовался в HTTP/1.0, но в HTTP/1.1 он устарел и практически не используется для передачи бинарных данных, так как сам HTTP уже может передавать их "как есть".
    

**Пример:**

Когда вы запрашиваете изображение на веб-странице (`<img src="my_image.jpg">`), происходит следующее:

1. Браузер отправляет `GET /my_image.jpg HTTP/1.1` запрос.
2. Сервер находит `my_image.jpg`, считывает его как последовательность байтов.
3. Сервер отправляет ответ:
    
    ```
    HTTP/1.1 200 OK
    Content-Type: image/jpeg
    Content-Length: 54321
    ... (другие заголовки)
    
    [Много байтов, представляющих изображение JPEG]
    ```
    
4. Браузер, прочитав `Content-Type: image/jpeg`, интерпретирует 54321 байт в теле ответа как JPEG-изображение и отображает его.


### Установка и Отключение HTTP-Соединения

Как упоминалось, HTTP работает поверх TCP. Процесс установки и отключения соединения касается именно TCP.

#### Установка Соединения (TCP Handshake)

1. **SYN (Synchronize):** Клиент отправляет TCP-пакет `SYN` на сервер, чтобы инициировать соединение.
2. **SYN-ACK (Synchronize-Acknowledgement):** Сервер получает `SYN`, выделяет ресурсы для соединения и отправляет обратно `SYN-ACK` пакет клиенту.
3. **ACK (Acknowledgement):** Клиент получает `SYN-ACK` и отправляет `ACK` пакет серверу, подтверждая установление соединения.
    

После этого трехстороннего рукопожатия (three-way handshake) TCP-соединение установлено, и по нему можно передавать HTTP-запросы и ответы.

#### Отключение Соединения (TCP Teardown)

Отключение TCP-соединения также является процессом в несколько этапов:

1. **FIN (Finish):** Когда одна из сторон (например, клиент) хочет закрыть соединение, она отправляет TCP-пакет `FIN`.
2. **ACK (Acknowledgement):** Другая сторона (сервер) получает `FIN` и отправляет `ACK`, подтверждая получение запроса на закрытие.
3. **FIN (Finish):** Когда сервер готов закрыть свою сторону соединения, он также отправляет `FIN`.
4. **ACK (Acknowledgement):** Клиент получает `FIN` и отправляет `ACK`, после чего соединение полностью закрывается.
    

### 5.3. HTTP/1.0, HTTP/1.1 и Соединения

- **HTTP/1.0:** Изначально, для каждого HTTP-запроса и ответа устанавливалось и закрывалось новое TCP-соединение. Это приводило к значительным накладным расходам (задержки из-за three-way handshake).
    
- **HTTP/1.1 (Persistent Connections / Keep-Alive):** Введены "постоянные соединения" (persistent connections), также известные как `keep-alive`. Это означает, что после отправки ответа сервер не сразу закрывает TCP-соединение, а оставляет его открытым на некоторое время (или до явного запроса клиента на закрытие). Это позволяет клиенту отправлять несколько запросов по одному и тому же соединению, значительно снижая накладные расходы и ускоряя загрузку страниц (особенно при запросе множества ресурсов: изображений, CSS, JS). Заголовок `Connection: keep-alive` (хотя в HTTP/1.1 он подразумевается по умолчанию, если нет `Connection: close`) управляет этим поведением.
    
- **HTTP/2 и HTTP/3:** Эти версии протокола развивают концепцию постоянных соединений, используя мультиплексирование (multiplexing) по одному TCP-соединению (HTTP/2) или QUIC-соединению (HTTP/3), что позволяет передавать множество запросов и ответов одновременно, значительно улучшая производительность.