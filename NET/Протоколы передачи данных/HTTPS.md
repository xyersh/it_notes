
###  База HTTPS

**HTTPS (Hypertext Transfer Protocol Secure)** — это не просто небольшое дополнение к HTTP. Это фундаментальное изменение, которое обеспечивает защиту данных, передаваемых между вашим браузером и веб-сайтом. Он является залогом вашей безопасности при совершении онлайн-покупок, входе в банковские приложения, обмене личными сообщениями и многом другом.

## Что такое HTTPS и как он работает?

HTTPS — это защищенная версия протокола HTTP. Основное отличие заключается в том, что HTTPS использует протокол **TLS (Transport Layer Security)**, который является преемником SSL (Secure Sockets Layer), для шифрования данных. TLS/SSL обеспечивает:

- **Шифрование:** Данные, передаваемые между клиентом (браузером) и сервером, шифруются, что делает их нечитаемыми для сторонних лиц. Даже если злоумышленник перехватит данные, он не сможет их расшифровать.
-  **Целостность данных:** Протокол гарантирует, что данные не были изменены или повреждены во время передачи. Любое изменение будет обнаружено.
- **Аутентификация:** HTTPS подтверждает подлинность веб-сайта, к которому вы подключаетесь. Это помогает предотвратить фишинговые атаки и подключение к поддельным сайтам.



### Как происходит обмен сообщениями в HTTPS? (Пошаговое объяснение)

Обмен сообщениями по HTTPS происходит следующим образом:

1. **Рукопожатие TLS (TLS Handshake):** Это самая сложная и важная часть процесса.
    
    - **Шаг 1: Client Hello.** Ваш браузер отправляет на сервер сообщение "Client Hello". В нем содержится:
        - Версия TLS, которую поддерживает браузер.
        - Список криптографических наборов (Cipher Suites), поддерживаемых браузером (например, алгоритмы шифрования, хеширования и обмена ключами).
        - Случайное число (Client Random) для генерации сессионного ключа.
            
    - **Шаг 2: Server Hello.** Сервер получает "Client Hello" и отвечает сообщением "Server Hello", содержащим:
        - Выбранную версию TLS (из предложенных клиентом).
        - Выбранный криптографический набор (из предложенных клиентом).
        - Случайное число (Server Random) для генерации сессионного ключа.
        - **Цифровой сертификат сервера (Server Certificate).** Это ключевой элемент, содержащий:
	        - публичный ключ сервера, 
	        - информацию о сервере/домене(название организации,  местоположение и тд)
	        - срок действия сертификата
	        - Информация о центре сертификации (CA) , который выдал и подписал этот сертификат
	        - а также цифровую подпись центра сертификации (CA) - CA подписывает весь сертификат своим приватным ключом
            
    - **Шаг 3: Верификация сертификата клиентом.** Ваш браузер получает сертификат сервера и выполняет следующие проверки:
        - Срок действия сертификата.
        - Доменное имя в сертификате соответствует домену, к которому обращается браузер.
        - Сертификат подписан доверенным Центром Сертификации (CA), корневой сертификат которого установлен в вашей операционной системе/браузере. Если любая из этих проверок не проходит, браузер выдаст предупреждение о небезопасном соединении.
            
    - **Шаг 4: Обмен ключами.**
        
        - Используя публичный ключ сервера (из его сертификата) и алгоритм обмена ключами (например, Diffie-Hellman или RSA), клиент и сервер генерируют **Pre-Master Secret**.
            
        - Из Pre-Master Secret, Client Random и Server Random, обе стороны независимо друг от друга вычисляют **Master Secret**.
            
        - На основе Master Secret генерируются **сессионные ключи (Session Keys)** – симметричные ключи, которые будут использоваться для шифрования и дешифрования всех последующих данных. Важно: эти ключи уникальны для каждой сессии и не передаются по сети напрямую.
            
    - **Шаг 5: Client Finished и Server Finished.** Клиент и сервер обмениваются зашифрованными сообщениями "Finished", подтверждая, что рукопожатие завершено и они готовы к защищенной связи.
        
2. **Зашифрованный обмен данными:** После успешного рукопожатия TLS, все последующие HTTP-запросы и ответы шифруются с использованием сгенерированных сессионных ключей.
    
    - **Отправка сообщения:** Ваш браузер шифрует HTTP-запрос (например, GET /index.html) с помощью сессионного ключа и отправляет его на сервер.
        
    - **Получение сообщения:** Сервер получает зашифрованный запрос, расшифровывает его с помощью того же сессионного ключа, обрабатывает его и формирует HTTP-ответ. Затем сервер шифрует этот ответ и отправляет его обратно клиенту.
        
    - **Дешифровка:** Ваш браузер получает зашифрованный ответ, расшифровывает его и отображает содержимое веб-страницы.
        

Таким образом, HTTP-сообщения (заголовки, тело запроса/ответа) инкапсулируются внутри зашифрованного туннеля TLS.

### Установка и отключение HTTPS-соединения

- **Установка:** Как было описано выше, установка HTTPS-соединения начинается с запроса клиента (обычно через ввод `https://` в адресной строке или переход по ссылке) и последующего рукопожатия TLS, которое устанавливает защищенный канал.
    
- **Отключение:** HTTPS-соединение может быть отключено как клиентом, так и сервером. Это происходит, когда:
    
    - Пользователь закрывает вкладку или браузер.
    - Истекает время ожидания (таймаут) неактивного соединения.
    - Сервер или клиент явно закрывают соединение.
    - В случае, если пользователь переходит на другой сайт, соединение с текущим сайтом может быть закрыто.
    - В отличие от HTTP, где каждое соединение может быть независимым, HTTPS часто использует постоянные соединения (Keep-Alive) для более эффективного обмена несколькими запросами/ответами в рамках одной TLS-сессии, чтобы избежать накладных расходов на повторное рукопожатие.
        

## Важные аспекты, характеризующие протокол HTTPS

1. **Использование портов:** По умолчанию HTTPS использует порт **443**, в то время как HTTP использует порт 80.
2. **Сертификаты X.509:** HTTPS опирается на систему цифровых сертификатов X.509, выдаваемых Центрами Сертификации (CA). Эти сертификаты являются основой для аутентификации сервера.
3. **Центры Сертификации (CA):** CA — это доверенные организации, которые проверяют подлинность доменных имен и выдают сертификаты. Ваш браузер доверяет списку корневых CA, встроенных в операционную систему или браузер.
4. **Различные типы сертификатов:**
    
    - **Domain Validation (DV):** Проверяет только владение доменом. Самый простой и быстрый в получении.
    - **Organization Validation (OV):** Проверяет владение доменом и существование организации. Требует больше проверок.
    - **Extended Validation (EV):** Самый строгий уровень проверки, который включает тщательную проверку организации. В некоторых браузерах отображает название организации в адресной строке (хотя сейчас это становится менее распространенным).
        
5. **Chain of Trust (Цепочка доверия):** Сертификаты обычно формируют цепочку: конечный сертификат (сайта) подписан промежуточным CA, который в свою очередь подписан корневым CA. Браузер проверяет эту цепочку до корня, чтобы убедиться в подлинности.
6. **Perfect Forward Secrecy (PFS):** Современные реализации TLS поддерживают PFS, что означает, что даже если злоумышленник получит доступ к приватному ключу сервера в будущем, он не сможет расшифровать ранее перехваченный трафик. Это достигается за счет использования эфемерных ключей для каждой сессии.

7. **Server Name Indication (SNI):** Расширение TLS, которое позволяет серверу размещать несколько SSL/TLS сертификатов на одном IP-адресе. Это крайне важно для хостинга множества сайтов на одном сервере с HTTPS.
    
8. **HTTP Strict Transport Security (HSTS):** Заголовок безопасности, который заставляет браузер всегда использовать HTTPS для конкретного домена, даже если пользователь вводит HTTP. Это предотвращает атаки "man-in-the-middle", которые могут пытаться перенаправить пользователя на незащищенное HTTP-соединение.
    

### HTTPS решает три основные проблемы безопасности:

1. **Перехват данных (Eavesdropping / Snooping):**
    
    - **Проблема:** Злоумышленник может "слушать" вашу связь и перехватывать конфиденциальную информацию, такую как логины, пароли, данные кредитных карт, личные сообщения.
        
    - **Решение HTTPS:** **Шифрование.** Все данные, передаваемые между клиентом и сервером, шифруются с использованием сессионных ключей. Это делает перехваченные данные бессмысленным набором символов для злоумышленника. TLS использует комбинацию асимметричного шифрования (для обмена ключами) и симметричного шифрования (для передачи данных).
        
2. **Подделка/Изменение данных (Tampering / Data Integrity):**
    
    - **Проблема:** Злоумышленник может изменить данные во время их передачи, например, подменить сумму транзакции, изменить текст сообщения или внедрить вредоносный код.
        
    - **Решение HTTPS:** **Целостность данных и аутентификация сообщений.** TLS использует коды аутентификации сообщений (MAC - Message Authentication Codes) или хеши, чтобы гарантировать, что данные не были изменены. Каждое отправленное сообщение содержит криптографическую контрольную сумму. Если данные были изменены, контрольная сумма не совпадет при получении, и соединение будет разорвано, предупреждая о попытке манипуляции.
        
3. **Фишинг и подмена сайта (Phishing / Impersonation):**
    
    - **Проблема:** Злоумышленник может создать поддельный веб-сайт, который выглядит как настоящий, чтобы обманом заставить пользователей ввести свои учетные данные или другую конфиденциальную информацию. Без аутентификации, пользователь не может быть уверен, что он действительно общается с нужным сервером.
        
    - **Решение HTTPS:** **Аутентификация сервера.** Цифровые сертификаты, выдаваемые доверенными Центрами Сертификации, подтверждают подлинность веб-сайта. Когда ваш браузер проверяет сертификат, он убеждается, что он действительно подключился к серверу Google, а не к его имитации. Это значительно снижает риск фишинговых атак, так как подделать действительный сертификат для чужого домена практически невозможно (без компрометации CA).
        

## Оценочное сравнение протоколов HTTP и HTTPS

| Характеристика           | HTTP (Hypertext Transfer Protocol)                              | HTTPS (Hypertext Transfer Protocol Secure)                                                 | Примечания                                                                                                 |
| ------------------------ | --------------------------------------------------------------- | ------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------- |
| **Безопасность данных**  | **Отсутствует.** Данные передаются в открытом виде (plaintext). | **Высокая.** Данные шифруются с использованием TLS/SSL.                                    | Ключевое отличие. Вся конфиденциальная информация должна передаваться только через HTTPS.                  |
| **Целостность данных**   | **Отсутствует.** Нет механизмов для проверки изменения данных.  | **Высокая.** Механизмы хеширования и MAC гарантируют целостность.                          | Защищает от подмены информации в пути.                                                                     |
| **Аутентификация**       | **Отсутствует.** Нет возможности проверить подлинность сервера. | **Высокая.** Цифровые сертификаты подтверждают подлинность сервера.                        | Предотвращает фишинг и атаки "человек посередине".                                                         |
| **Порт по умолчанию**    | 80                                                              | 443                                                                                        | Стандартные порты.                                                                                         |
| **Производительность**   | Быстрее (меньше накладных расходов).                            | Медленнее (дополнительные накладные расходы на шифрование/дешифрование и рукопожатие TLS). | Разница в производительности снижается с развитием технологий (аппаратное ускорение, оптимизация TLS 1.3). |
| **Требования к серверу** | Не требуется сертификат.                                        | Требуется SSL/TLS сертификат, выданный CA.                                                 | Необходимые затраты (временные и финансовые) на получение и управление сертификатом.                       |
| **Доверие пользователя** | **Низкое.** Браузеры помечают HTTP-сайты как "Не защищено".     | **Высокое.** Браузеры отображают значок замка, указывая на безопасное соединение.          | Влияет на UX и репутацию сайта. Пользователи все больше обращают внимание на наличие HTTPS.                |
| **SEO (Ранжирование)**   | Негативное влияние. Google предпочитает HTTPS-сайты.            | Положительное влияние. Является фактором ранжирования в Google.                            | Для любого серьезного веб-проекта HTTPS является обязательным для SEO.                                     |
| **Использование**        | Устаревший, небезопасный. Используется редко.                   | **Стандарт де-факто** для большинства современных веб-сайтов.                              | Практически все веб-сайты, обрабатывающие личные данные, должны использовать HTTPS.                        |
| **Сложность настройки**  | Проще.                                                          | Сложнее (настройка сертификата, веб-сервера).                                              | Требует определенных технических знаний для правильной настройки.                                          |
| **Кэширование**          | Более простое кэширование прокси-серверами.                     | Сложнее кэширование прокси-серверами из-за шифрования.                                     | Влияет на работу CDN и прокси.                                                                             |


