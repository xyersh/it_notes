Иногда в процессе работы приходится добавлять в словарь большое количество элементов. Рассмотрим пример, который не является классическим случаем утечки памяти, но всё же может привести к излишнему потреблению памяти:

```go
func main() {
	data := make(map[int][128]byte, 1_000_000)
	for i := 0; i < 1_000_000; i++ {
		data[i] = [128]byte{}
	}

	// using big data

	for i := 0; i < 1_000_000; i++ {
		delete(data, i)
	}

	// further I will work only 
	// with a small number of keys
}
```


Если удалить все значения из словаря, память всё равно не освободится. На моей машине словарь будет занимать около 293 МB, даже если я потом буду использовать только несколько ключей в словаре.

**Так происходит из-за особенностей работы словарей в Go. Бакеты словарей, в которых хранятся элементы, не освобождаются, даже если они становятся пустыми.**

**Решение**

1. Нужно либо присвоить словарю nil. Это позволит сборщику мусора освободить память, выделенную для словаря, включая бакеты.
2. Либо использовать указатели на массив вместо массива размером 128 байт. Это позволит избежать излишнего потребления памяти, так как в бакетах будут храниться только указатели на массивы, которые будут обнулены, а не сами массивы.


**Занимательный момент: если размер ключа или значения в словаре больше 128 байт, то в бакете будет храниться указатель на значение, а не само значение.**