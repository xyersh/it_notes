
**Sync.Mutex** – это механизм синхронизации в Go, который используется для предотвращения гонок данных. Гонка данных возникает, когда несколько горутин одновременно пытаются получить доступ и модифицировать одни и те же данные. Это может привести к непредсказуемым результатам и ошибкам в программе.

**Зачем нужен Sync.Mutex?**

- **Защита критических секций:** Мьютекс позволяет защитить блок кода (критическую секцию) так, чтобы только одна горутина могла выполнить его в данный момент времени.
- **Предотвращение гонок данных:** Гарантирует, что доступ к общим данным будет последовательным, а не параллельным, что устраняет возможность возникновения гонок данных.

**Простой пример:**

Представим, что у нас есть счетчик, который мы хотим увеличивать из нескольких горутин. Без синхронизации, значение счетчика может быть некорректным из-за гонок данных.

```go
package main

import (
        "fmt"
        "sync"
)

var (
        counter int
        mutex   sync.Mutex
)

func increment() {
        mutex.Lock()
        counter++
        mutex.Unlock()
}

func main() {
        var wg sync.WaitGroup
        for i := 0; i < 1000; i++ {
                wg.Add(1)
                go func() {
                        defer wg.Done()
                        increment()
                }()
        }
        wg.Wait()
        fmt.Println("Final counter value:", counter)
}
```

**Разберем код:**

1. **Объявление переменных:**
    - `counter`: Счетчик, который мы будем увеличивать.
    - `mutex`: Мьютекс для синхронизации доступа к счетчику.
2. **Функция increment:**
    - Захватывает мьютекс перед изменением счетчика.
    - Увеличивает значение счетчика.
    - Освобождает мьютекс.
3. **Основная функция main:**
    - Создает 1000 горутин, каждая из которых вызывает функцию `increment`.
    - Используется `sync.WaitGroup` для ожидания завершения всех горутин.

**Как работает:**

- Перед тем как изменить значение счетчика, горутина должна захватить мьютекс.
- Только одна горутина может владеть мьютексом в данный момент.
- После изменения значения счетчика, горутина освобождает мьютекс, позволяя другим горутинам получить к нему доступ.

**Благодаря использованию мьютекса, мы гарантируем, что значение счетчика будет увеличено на 1000, даже если к нему одновременно обращаются многочисленные горутины.**